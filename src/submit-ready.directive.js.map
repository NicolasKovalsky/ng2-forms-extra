{"version":3,"file":"submit-ready.directive.js","sourceRoot":"","sources":["submit-ready.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {Directive, HostListener, Output, EventEmitter, Host, OnDestroy, forwardRef} from \"@angular/core\";\nimport {ControlContainer} from \"@angular/forms\";\nimport {SubmitService} from \"./submit.service\";\nimport {ReadyForSubmit, RegistryHandle} from \"./model\";\n\nconst resolved = Promise.resolve();\n\n@Directive({\n    selector: 'form:not([ngNoForm]),ngForm,[ngForm],[formGroup]',\n    exportAs: \"frexSubmit\",\n    providers: [\n        {\n            provide: SubmitService,\n            useExisting: forwardRef(() => SubmitReadyDirective),\n        },\n    ]\n})\nexport class SubmitReadyDirective extends SubmitService implements OnDestroy {\n\n    @Output()\n    readonly readyStateChanges = new EventEmitter<boolean>();\n\n    @Output()\n    readonly preSubmit = new EventEmitter<any>();\n\n    @Output()\n    readonly submitReady = new EventEmitter<any>();\n\n    private _ready = true;\n    private _idSeq = 0;\n    private _readyForSubmit: {[id: string]: ReadyForSubmit} = {};\n\n    constructor() {\n        super();\n    }\n\n    get ready(): boolean {\n        return this._ready;\n    }\n\n    @HostListener('ngSubmit')\n    onSubmit() {\n        this.submit();\n    }\n\n    addReadyForSubmit(ready: ReadyForSubmit): RegistryHandle {\n\n        const id = \"\" + ++this._idSeq;\n\n        this._readyForSubmit[id] = ready;\n\n        const subscr = ready.readyStateChanges.subscribe((ready: boolean) => {\n            if (!ready) {\n                resolved.then(() => this.setReadyState(false));\n            } else {\n                resolved.then(() => this.updateReadyState());\n            }\n        });\n\n        return {\n            unregister: () => {\n                delete this._readyForSubmit[id];\n                subscr.unsubscribe();\n            }\n        };\n    }\n\n    updateReadyState({emitEvents = true}: {emitEvents?: boolean} = {}): boolean {\n\n        let ready = true;\n\n        for (let id in this._readyForSubmit) {\n            if (this._readyForSubmit.hasOwnProperty(id)) {\n                if (!this._readyForSubmit[id].updateReadyState({emitEvents})) {\n                    ready = false;\n                    break;\n                }\n            }\n        }\n\n        this.setReadyState(ready, {emitEvents});\n\n        return ready;\n    }\n\n    private setReadyState(ready: boolean, {emitEvents = true}: {emitEvents?: boolean} = {}) {\n        if (this._ready === ready) {\n            return;\n        }\n        this._ready = ready;\n        if (emitEvents !== false) {\n            this.readyStateChanges.emit(ready);\n        }\n    }\n\n    submit(): boolean {\n        this._submitted = true;\n        this.preSubmit.emit(null);\n        if (!this.updateReadyState({emitEvents: false})) {\n            return false;\n        }\n        this.submitReady.emit(null);\n        return true;\n    }\n\n    ngOnDestroy() {\n        this.submitReady.complete();\n    }\n\n}\n"]}