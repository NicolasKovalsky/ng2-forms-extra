{"version":3,"file":"input-errors.component.js","sourceRoot":"","sources":["input-errors.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component, Input, OnDestroy, Optional, OnInit} from \"@angular/core\";\nimport {Subscription} from \"rxjs\";\nimport {Submittable, SubmitGroup} from \"./model\";\n\nexport interface InputErrorMap {\n    [key: string]: string | ((error: any, submittable: Submittable) => string)\n}\n\nconst DEFAULT_INPUT_ERRORS_MAP: InputErrorMap = {\n    required: \"This field is required\",\n    minlength: (error: {requiredLength: number}) => {\n        if (error && error.requiredLength > 0) {\n            return \"The value should be at least \" + error.requiredLength + \" characters long\";\n        }\n        return \"The value is too short\";\n    },\n    maxlength: (error: {requiredLength: number}) => {\n        if (error && error.requiredLength > 0) {\n            return \"The value should be at most \" + error.requiredLength + \" characters long\";\n        }\n        return \"The value is too long\";\n    },\n};\n\nexport interface InputError {\n    key: string;\n    message: string;\n}\n\nconst resolved = Promise.resolve();\n\n@Component({\n    selector: 'input-errors,[inputErrors],[inputErrorsMap]',\n    template:\n    `\n    <ul class=\"frex-error-list\" *ngIf=\"hasErrors\">\n        <li *ngFor=\"let error of errors; trackBy: trackError\" class=\"frex-error\">{{error.message}}</li>\n    </ul>\n    `,\n    host: {\n        '[class.frex-errors]': 'true',\n        '[class.frex-no-errors]': '!hasErrors',\n    }\n})\nexport class InputErrorsComponent implements OnInit, OnDestroy {\n\n    private _subscription?: Subscription;\n    private _errors: InputError[] = [];\n\n    @Input()\n    private inputErrorsMap: InputErrorMap = {};\n\n    constructor(@Optional() private _submitGroup: SubmitGroup) {\n    }\n\n    get hasErrors(): boolean {\n        return !this._submitGroup.inputStatus.ready && this.errors.length > 0;\n    }\n\n    get errors(): InputError[] {\n        return this._errors;\n    }\n\n    ngOnInit() {\n        this._subscription = this._submitGroup.submittableChanges.subscribe(\n            (submittables: Submittable[]) => this.updateSubmittables(submittables));\n        this.updateSubmittables(this._submitGroup.submittables);\n    }\n\n    ngOnDestroy() {\n        if (this._subscription) {\n            this._subscription.unsubscribe();\n            delete this._subscription;\n        }\n    }\n\n    private trackError(error: InputError) {\n        return error.key;\n    }\n\n    private updateSubmittables(submittables: Submittable[]) {\n\n        const updateErrors = () => resolved.then(() => {\n            this._errors.splice(0);\n            submittables.forEach(submittable => {\n\n                const errors = submittable.inputStatus.errors;\n\n                if (errors) {\n                    for (let key in errors) {\n                        if (errors.hasOwnProperty(key)) {\n\n                            const message = this.errorMessage(submittable, key, errors[key]);\n\n                            if (message != null) {\n                                this._errors.push({key, message});\n                            }\n                        }\n                    }\n                }\n            });\n        });\n\n        submittables.forEach(s => s.inputStatusChange.subscribe(updateErrors));\n        updateErrors();\n    }\n\n    private errorMessage(control: Submittable, key: string, value: any): string | undefined {\n        if (value == null) {\n            return undefined;\n        }\n\n        const known = this.inputErrorsMap[key];\n\n        if (known != null) {\n            return errorMessage(control, value, known);\n        }\n\n        const defaultMsg = errorMessage(control, value, DEFAULT_INPUT_ERRORS_MAP[key]);\n\n        if (defaultMsg != null) {\n            return defaultMsg;\n        }\n        if (typeof value === \"string\") {\n            return value;\n        }\n\n        return key;\n    }\n\n}\n\nfunction errorMessage(\n    submittable: Submittable,\n    value: any,\n    message: undefined | string | ((value: any, submittable: Submittable) => string)): string | undefined {\n    if (message == null) {\n        return undefined;\n    }\n    if (typeof message === \"string\") {\n        return message;\n    }\n    return message(value, submittable);\n}\n"]}