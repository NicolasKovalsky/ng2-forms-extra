{"version":3,"file":"input-errors.component.js","sourceRoot":"","sources":["input-errors.component.ts"],"names":[],"mappings":"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","sourcesContent":["import {Component, Input, OnDestroy, AfterViewInit, Optional, OnInit} from \"@angular/core\";\nimport {AbstractControl} from \"@angular/forms\";\nimport {Subscription} from \"rxjs\";\nimport {InputService} from \"./input.service\";\n\nexport interface InputErrorMap {\n    [key: string]: string | ((error: any, control: AbstractControl) => string)\n}\n\nconst DEFAULT_INPUT_ERRORS_MAP: InputErrorMap = {\n    required: \"This field is required\",\n    minlength: (error: {requiredLength: number}) => {\n        if (error && error.requiredLength > 0) {\n            return \"The value should be at least \" + error.requiredLength + \" characters long\";\n        }\n        return \"The value is too short\";\n    },\n    maxlength: (error: {requiredLength: number}) => {\n        if (error && error.requiredLength > 0) {\n            return \"The value should be at most \" + error.requiredLength + \" characters long\";\n        }\n        return \"The value is too long\";\n    },\n};\n\nexport interface InputError {\n    key: string;\n    message: string;\n}\n\n@Component({\n    selector: 'input-errors,[inputErrors],[inputErrorsMap]',\n    template:\n    `\n    <ul class=\"frex-error-list\" *ngIf=\"hasErrors\">\n        <li *ngFor=\"let error of errors; trackBy: trackError\" class=\"frex-error\">{{error.message}}</li>\n    </ul>\n    `,\n    host: {\n        '[class.frex-errors]': 'true',\n        '[class.frex-errors-hidden]': '!hasErrors',\n    }\n})\nexport class InputErrorsComponent implements OnInit, AfterViewInit, OnDestroy {\n\n    private _input: AbstractControl;\n    private _subscription?: Subscription;\n    private _errors: InputError[] = [];\n\n    @Input()\n    private inputErrorsMap: InputErrorMap = {};\n\n    constructor(@Optional() private _inputService: InputService) {\n    }\n\n    @Input()\n    set inputErrors(input: AbstractControl) {\n        if (this._input === input) {\n            return;\n        }\n        this._input = input;\n        this.unsubscribe();\n        this.subscribe();\n    }\n\n    get hasErrors(): boolean {\n        return !this._inputService.ready && this.errors.length > 0;\n    }\n\n    get errors(): InputError[] {\n        return this._errors;\n    }\n\n    ngOnInit() {\n        if (!this._subscription) {\n            this.subscribe();\n        }\n    }\n\n    ngAfterViewInit() {\n        if (!this._subscription) {\n            this.subscribe();\n        }\n    }\n\n    ngOnDestroy() {\n        this.unsubscribe()\n    }\n\n    private trackError(error: InputError) {\n        return error.key;\n    }\n\n    private subscribe() {\n        if (this._input) {\n            this._subscription = this._input.statusChanges.subscribe(\n                () => this.updateInputs([this._input]));\n        } else if (this._inputService) {\n            this._subscription = this._inputService.controlChanges.subscribe(\n                () => this.updateInputs(this._inputService.controls));\n        }\n    }\n\n    private updateInputs(controls: AbstractControl[]) {\n\n        const updateErrors = () => {\n            this._errors.splice(0);\n            controls.filter(control => !!control.errors).forEach(control => {\n\n                const errors = control.errors;\n\n                for (let key in errors) {\n                    if (errors.hasOwnProperty(key)) {\n\n                        const message = this.errorMessage(control, key, errors[key]);\n\n                        if (message != null) {\n                            this._errors.push({key, message});\n                        }\n                    }\n                }\n            });\n        };\n\n        controls.forEach(control => control.statusChanges.subscribe(updateErrors));\n        updateErrors();\n    }\n\n    private errorMessage(control: AbstractControl, key: string, value: any): string | undefined {\n        if (value == null) {\n            return undefined;\n        }\n\n        const known = this.inputErrorsMap[key];\n\n        if (known != null) {\n            return errorMessage(control, value, known);\n        }\n\n        const defaultMsg = errorMessage(control, value, DEFAULT_INPUT_ERRORS_MAP[key]);\n\n        if (defaultMsg != null) {\n            return defaultMsg;\n        }\n        if (typeof value === \"string\") {\n            return value;\n        }\n\n        return key;\n    }\n\n    private unsubscribe() {\n        if (this._subscription) {\n            this._subscription.unsubscribe();\n            this._subscription = undefined;\n        }\n    }\n\n}\n\nfunction errorMessage(\n    control: AbstractControl,\n    value: any,\n    message: undefined | string | ((value: any, control: AbstractControl) => string)): string | undefined {\n    if (message == null) {\n        return undefined;\n    }\n    if (typeof message === \"string\") {\n        return message;\n    }\n    return message(value, control);\n}\n"]}